#功能描述
- 在人脸闸机、人脸考勤等场景中，将实时捕获的人脸与人脸库中的人脸进行比对，返回人脸识别结果，从而进行人脸身份验证。

#接口说明
- 将实时捕获的人脸与人脸库中的人脸进行比对，返回人脸识别结果，从而进行人脸身份验证。包括以下接口：人脸注册、人脸更新、人脸删除、人脸查找、人脸检测、人脸比对（1:N）、人脸比对（1:1）。  

#约束限制
- 图片不超过4M
- 图片清晰、
- 光照充足、避免反光、
- 图片中需有人脸，且人脸不小于100px

##（1）接口1：人脸注册接口

**接口描述**：对白名单的人脸信息进行注册，生成对应的人脸特征库，返回人脸库唯一标识及注册结果。

**HTTP方法**：POST

**接口地址**：http://open-platform-gateway.dev.ennewi.cn/cv/face/face_register


**请求说明：**

**请求Header：**

| **参数**     | **值**              |
|--------------|---------------------|
| Content-Type | multipart/form-data |
| X-GW-Authorization | token申请参见《token获取》 |

**请求Body**：

| **参数**       | **类型**     | **是否必填** | **取值范围** | **说明**                                                                                                                                                 |
|----------------|--------------|--------------|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| image          | 二进制数据流 | 是           | --           | 将待识别图片转成2进制                                                                                                                                    |
| app_id         | string       | 是           |              | 人脸库唯一标识，不同人脸库数据隔离，该字段取值需要线下与算法方进行沟通后填入。                                                                           |
| user_id        | string       | 是           |              | 人员唯一标识id，同一个app_id下的user_id不能重复                                                                                                          |
| face_direction | string       | 否           |              | 采集人脸的方向，默认为空（即5个方向的人脸都可入库）；如指定标识如"1",表示入库的人脸为左侧脸，其他方向不入库。0：正面，1：左侧，2：右侧，3：上方，4：下方 |

**请求示例**：
```
{

"image": "二进制数据流。",

"app_id":“fdioajdfsi”，

"user_id":"A_sifjeo930283",

"face_direction":"1"

}
```
**返回说明：**

**返回参数**：

| **参数**     | **类型** | **是否必填** | **说明**                                                                                                                                                            |
|--------------|----------|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| code         | int      | 是           | 状态码                                                                                                                                                              |
| message      | string   | 是           | 状态码说明                                                                                                                                                          |
| check_result | int      | 是           | 返回注册结果。注册成功：0：合格；注册失败：10:未检测到人脸，20：图片模糊，30：光照太强，31.光线不足，40：face_direction参数方向和实际人脸拍摄方向不符，50：其他问题 |
| face_id      | int      | 是           | 人脸id，注册失败返回-1（数据库中有同一人脸照片 返回的id为此数据库照片的id）                                                                                         |

**返回示例**：
```
{

"code":"200",

"message":"success",

"register_result":0,

"face_id":11111111111111

}
```


##（2）接口2：人脸更新接口

**接口描述**：用于对指定人脸库的指定用户，更新人脸图片。

**HTTP方法**：POST

**接口地址**：http://open-platform-gateway.dev.ennewi.cn/cv/face/face_update

**请求说明：**

**请求Header：**

| **参数**     | **值**              |
|--------------|---------------------|
| Content-Type | multipart/form-data |

**请求Body**：

| **参数**       | **类型** | **是否必填** | **取值范围** | **说明**                                                                                                                                                 |
|----------------|----------|--------------|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| image          |          | 是           | --           | 将待识别图片转成2进制（输入图片表示更新人脸图片，不输入图片表示删除输入的faceid）                                                                        |
| app_id         | string   | 是           |              | 人脸库唯一标识，不同人脸库数据隔离，该字段取值需要线下与算法使用方进行沟通后填入。                                                                       |
| face_id        | string   | 是           |              | 人脸id，待更新的人脸图片                                                                                                                                 |
| face_direction | string   | 否           |              | 采集人脸的方向，默认为空（即5个方向的人脸都可入库）；如指定标识如"1",表示入库的人脸为左侧脸，其他方向不入库。0：正面，1：左侧，2：右侧，3：上方，4：下方 |

**请求示例**：
```
{

"image": "二进制数据流。",

"app_id":“fdioajdfsi”,

"face_id":"jidojasda"

}
```
**返回说明：**

**返回参数**：

| **参数**     | **类型** | **是否必填** | **说明**                                                                                                                                                            |
|--------------|----------|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| code         | int      | 是           | 状态码                                                                                                                                                              |
| message      | string   | 是           | 状态码说明                                                                                                                                                          |
| check_result | int      | 是           | 返回注册结果。注册成功：0：合格；注册失败：10:未检测到人脸，20：图片模糊，30：光照太强，31.光线不足，40：face_direction参数方向和实际人脸拍摄方向不符，50：其他问题 |
| face_id      | int      | 是           | 更新后的人脸id，注册失败返回-1（数据库中有同一人脸照片 返回的id为此数据库照片的id）                                                                                 |

**返回示例**：
```
{

"code":"200",

"message":"success",

"register_result":0,

"face_id":"123455666666"

}
```


##（3）接口3：人脸删除接口

**接口描述**：用于对指定人脸库的指定用户，删除人脸图片。

**HTTP方法**：POST

**接口地址**：http://open-platform-gateway.dev.ennewi.cn/cv/face/face_delete

**请求说明：**

**请求Header：**

| **参数**     | **值**              |
|--------------|---------------------|
| Content-Type | multipart/form-data |

**请求Body**：

| **参数** | **类型** | **是否必填** | **取值范围** | **说明**                                                                           |
|----------|----------|--------------|--------------|------------------------------------------------------------------------------------|
| app_id   | string   | 是           |              | 人脸库唯一标识，不同人脸库数据隔离，该字段取值需要线下与算法使用方进行沟通后填入。 |
| face_id  | int      | 是           |              | 人脸id                                                                             |

**请求示例**：
```
{

"app_id":“fdioajdfsi”,

"face_id":"jidojasda"

}
```
**返回说明：**

**返回参数**：

| **参数** | **类型** | **是否必填** | **说明**                   |
|----------|----------|--------------|----------------------------|
| code     | int      | 是           | 状态码                     |
| message  | string   | 是           | 状态码说明                 |
| face_id  | int      | 是           | 删除人脸id，注册失败返回-1 |

**返回示例**：
```
{

"code":"200",

"message":"success"

"face_id":"daidosjfi23"

}
```

##（4）接口4：人脸查找接口

**接口描述**：用于对指定人脸库的指定用户，查找人脸注册的faceid。

**HTTP方法**：POST

**接口地址**：http://open-platform-gateway.dev.ennewi.cn/cv/face/face_search

**请求说明：**

**请求Header：**

| **参数**     | **值**              |
|--------------|---------------------|
| Content-Type | multipart/form-data |


**请求Body**：

| **参数** | **类型** | **是否必填** | **取值范围** | **说明**                                                                           |
|----------|----------|--------------|--------------|------------------------------------------------------------------------------------|
| app_id   | string   | 是           |              | 人脸库唯一标识，不同人脸库数据隔离，该字段取值需要线下与算法使用方进行沟通后填入。 |
| user_id  | string   | 是           |              | 用户id                                                                             |
**请求示例**：
```
{

"app_id":“fdioajdfsi”,

"user_id":"jidojasda"

}
```
**返回说明：**

**返回参数**：

| **参数** | **类型** | **是否必填** | **说明**                   |
|----------|----------|--------------|----------------------------|
| code     | int      | 是           | 状态码                     |
| message  | string   | 是           | 状态码说明                 |
| result   | list     | 是           | 返回所有查找到的人脸faceid |

**返回示例**：
```
{

"code":"200",

"message":"success"

"result":[1111111,1111222,33333313]

}
```


##（5）接口5：人脸检测接口

**接口描述**：对图片中的人脸位置进行检测，返回人脸的位置信息、人脸图片的质量信息。

**HTTP方法**：POST

**接口地址**：http://open-platform-gateway.dev.ennewi.cn/cv/face/face_check

**请求说明：**

**请求Header：**

| **参数**     | **值**              |
|--------------|---------------------|
| Content-Type | multipart/form-data |

**请求Body**：

| **参数** | **类型** | **是否必填** | **取值范围** | **说明**                                                    |
|----------|----------|--------------|--------------|-------------------------------------------------------------|
| image    |          | 是           | --           | 将待识别图片转成2进制编码                                   |
| max_num  | int      | 否           | 1\~100       | 人脸位置信息的个数，默认为1，只返回人脸分值最高的人脸信息。 |

**请求示例**：
```
{

"image": "转换后的图片2进制编码。",

"max_num":1

}
```
**返回说明：**

**返回参数**：

| **参数**          | **类型** | **是否必填** | **说明**                                                                                                                                                      |
|-------------------|----------|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| code              | int      | 是           | 状态码                                                                                                                                                        |
| message           | string   | 是           | 状态码说明                                                                                                                                                    |
| face_num          | int      | 是           | 返回检测到的人脸数量                                                                                                                                          |
| check_result      | int      | 是           | 返回检测结果。检测成功：0；检测失败：10:未检测到人脸，20：图片模糊，30：光照太强，31.光线不足，40：face_direction参数方向和实际人脸拍摄方向不符，50：其他问题 |
| face_information  | array    | 是           | 返回检测到的人脸信息，按分值从高到低依次返回                                                                                                                  |
| +face_location    | string   | 否           | 返回人脸位置信息，位置信息以左上角为原点，返回左上(x,y)和右下(x,y)的坐标信息                                                                                  |
| +face_probability | double   | 否           | 人脸置信度，取值范围0\~1，0最小、1最大，表示是一张人脸的置信率                                                                                                |
| +landmark         | array    | 否           | 关键点位置，下图仅供参考。                                                                                                                                    |

附录图片1：

![C:\\c2cbf04e34ec35cca025327f23602116](media/1f3e577316424a4f42a5fe3255273b94.tmp)

**返回示例**：
'''
{   
"code":"200",

"message":"success",

"face_num":1,

"face_information":[  
{

"check_result":0,

"face_location":"(11,22),(33,44)",

"face_probability":0.90,

"landmark":[  
{  
"x": 161.74819946289,  
"y": 163.30244445801  
}  
]

}  
]  
}
'''


名词解释：

（1）精准率（Precision）：就是检测为人脸的框中实际有多少是真正的人脸

（2）召回率（Recall）：就是检测出来的人脸占总人脸的比例；  
（3）拒绝率（TRR）：如99%，代表100次作弊假体攻击，会有99次被拒绝。

（4）误拒率（FRR）：如0.5%，指1000次真人请求，会有5次因为活体分数低于阈值被错误拒绝。

（5）通过率（TAR）：如99%，指100次真人请求，会有99次因为活体分数高于阈值而通过。

##（6）接口6：人脸识别（1:N）接口

**接口描述**：将即时采集采集的人脸图片与人脸库中的图片进行一一比对，返回相似度最高的人脸图片，一般认为两个人脸是同一个人。

**HTTP方法**：POST

**接口地址**：http://open-platform-gateway.dev.ennewi.cn/cv/face/face_recognise

**请求说明：**

**请求Header：**

| **参数**     | **值**              |
|--------------|---------------------|
| Content-Type | multipart/form-data |

**请求Body**：

| **参数** | **类型** | **是否必填** | **取值范围** | **说明**                  |
|----------|----------|--------------|--------------|---------------------------|
| image    | file         | 是           | --           | 将待识别图片转成2进制编码 |
| app_id   | string   | 是           |              | 人脸库id                  |

**请求示例**：
'''
{

"image": "转换后的图片2进制编码。",

"app_id":"fjidsjfd"

}
'''
**返回说明：**

**返回参数**：

| **参数**      | **类型** | **是否必填** | **说明**                                                                                                                                                      |
|---------------|----------|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| code          | int      | 是           | 状态码                                                                                                                                                        |
| message       | string   | 是           | 状态码说明                                                                                                                                                    |
| check\_result | int      | 是           | 返回检测结果。检测成功：0；检测失败：10:未检测到人脸，20：图片模糊，30：光照太强，31.光线不足，40：face_direction参数方向和实际人脸拍摄方向不符，50：其他问题 |
| user_id       | string   | 是           | 相似度最高的人员id，无相似人员返回-1                                                                                                                          |
| score         | float    | 是           | 相似度得分，无相似人员返回-1                                                                                                                                  |

**返回示例**：
'''
{

"code":"200",

"message":"success",

"check_result":0,

"user_id":"djiaojs86767",

"score":0.998

}
'''


名词解释：

FAR：认假率，表示错误的接受比例，指不是同一个人却被错误的认为是同一个人占所有不是同一个人比较的次数;

DIR(Detection and Identification Rate)：DIR衡量的是库内人员的通过性能。

##（7）接口7：人脸比对（1:1）接口

**接口描述**：比对两个人脸图片或一张人脸图片和人脸库中的一张人脸图片，是否为同一个人。

**HTTP方法**：POST

**接口地址**：http://open-platform-gateway.dev.ennewi.cn/cv/face/face_compare

**请求说明：**

**请求Header：**

| **参数**     | **值**              |
|--------------|---------------------|
| Content-Type | multipart/form-data |

**请求Body**：

| **参数** | **类型** | **是否必填** | **取值范围** | **说明**                        |
|----------|----------|--------------|--------------|---------------------------------|
| image    |file          | 是           | --           | 将待比对图片转成2进制编码       |
| image_1  | file         | 否           |              | 将与之比对图片转成2进制编码     |
| app_id   | string   | 否           |              | image_1和app_id两个参数二选一。 |
| user_id  | string   | 否           |              | 参数包含app_id,则此参数必填。   |

**请求示例**：
'''
{

"image": "转换后的图片2进制编码。",

"app_id":"1",

"user_id":"jdojaid8676776",

}
'''
**返回说明：**

**返回参数**：

| **参数**     | **类型** | **是否必填** | **说明**                                                                                                                                                      |
|--------------|----------|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| code         | int      | 是           | 状态码                                                                                                                                                        |
| message      | string   | 是           | 状态码说明                                                                                                                                                    |
| check_result | int      | 是           | 返回检测结果。检测成功：0；检测失败：10:未检测到人脸，20：图片模糊，30：光照太强，31.光线不足，40：face_direction参数方向和实际人脸拍摄方向不符，50：其他问题 |
| result       | Boolean  | 是           | 是否为同一个人，true：同一个人，false：不是同一个人，检测失败返回-1                                                                                           |
| score        | float    | 是           | 相似度得分，检测失败返回-1                                                                                                                                    |

**返回示例**：
'''
{

"code":"200",

"message":"success",

"check_result":0,

"result":true,

"score":0.9255

}
'''


名词解释：

FAR：认假率，表示错误的接受比例，指不是同一个人却被错误的认为是同一个人占所有不是同一个人比较的次数;

TAR：表示正确的接受比例，指是同一个人且被正确的认为是同一个人占所有同一个人比较的次数

FRR：错误拒绝率，指是同一个人但被认为不是同一个人占所有是同一个人比较的次数


**错误码**
| **状态码** | **状态码说明**               | **状态码含义**                       |
|------------|------------------------------|--------------------------------------|
| 200        | Success                      | 请求成功                             |
| 40201      | Not enough param             | 缺少必须的参数，请检查参数是否有遗漏 |
| 40202      | param too long               | 请求中某些参数过长，请检查后重新尝试 |
| 40203      | invalid param                | 请求中包含非法参数，请检查后重新尝试 |
| 40300      | Empty image                  | 图片为空，请检查后重新尝试           |
| 40301      | Image darkness error         | 图片亮度问题，图片过暗               |
| 40302      | Image quality error          | 图片质量问题，多为模糊图片           |
| 40303      | Image bright error           | 图片亮度问题，图片过亮               |
| 40304      | No face                      | 未检测到人脸                         |
| 40305      | Face direction match error   | 输入人脸方向与实际检测人脸方向不符   |
| 40306      | More than one face           | 检测到的人脸数目大于一               |
| 40307      | app_id error                 | 未输入appid或者其他错误              |
| 40308      | Input image error            | 图片输入错误，包括格式，数据为空等   |
| 40309      | user_id image not registed   | 输入的userid未在数据库注册，请先注册 |
| 40310      | user_id error                | 未输入userid或者其他错误             |
| 40311      | Not single face              | 人脸数目不等于一                     |
| 40312      | Database has no similar face | 数据库内未检测到相似人脸             |
| 40313      | Delete faceid failed         | 删除人脸数据库中人脸失败             |
| 40314      | Detect face failed           | 人脸检测失败                         |
| 40315      | Database has same face       | 人脸注册或更新时库种有同一人脸数据   |
| 40316      | Dababase has no appid        | appid数据库未发现，未注册入库        |
| 40317      | Dababase has no userid       | userid数据库未发现，未注册入库       |
| 40318      | Faceid error                 | 未输入faceid导致错误                 |
